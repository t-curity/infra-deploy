# T-curity 인프라 구성도

## 1. 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              Internet / Client                              │
└─────────────────────────────────────────┬───────────────────────────────────┘
                                          │
                                          ▼ HTTP/HTTPS (80/443)
┌─────────────────────────────────────────────────────────────────────────────┐
│                         Main Server (kakao cloud)                           │
│                     Public: 61.109.236.16                                   │
│                     Private: 10.0.3.151                                     │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │                         Nginx (Reverse Proxy)                         │  │
│  │                              Port 80/443                              │  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                    │  │
│  │  │     /       │  │   /api/*    │  │  /sdk.js    │                    │  │
│  │  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘                    │  │
│  └─────────┼────────────────┼────────────────┼───────────────────────────┘  │
│            │                │                │                              │
│            ▼                ▼                ▼                              │
│  ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐                │
│  │   Demo Site     │ │    Backend      │ │      SDK        │                │
│  │   (Vite Dev)    │ │   (FastAPI)     │ │  (Vite Dev)     │                │
│  │   Port 5173     │ │   Port 8000     │ │   Port 3000     │                │
│  │                 │ │        │        │ │                 │                │
│  └─────────────────┘ └────────┼────────┘ └─────────────────┘                │
│                               │                                             │
└──────────────────────────────┬──────────────────────────────────────────────┘
                               │
                               │ Private Network (HTTP)
                               │ 10.0.83.48:9000
                               ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                          GPU Server (kakao cloud)                           │
│                     Public: 61.109.238.4                                    │
│                     Private: 10.0.83.48                                     │
│                                                                             │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │                      AI Server (FastAPI + PyTorch)                    │  │
│  │                            Port 9000                                  │  │
│  │  ┌─────────────────────────────────────────────────────────────────┐  │  │
│  │  │  Phase A: Behavior Analysis (Isolation Forest)                  │  │  │
│  │  │  Phase B: Image Classification (EfficientNet) +                 │  │  │
│  │  │           Behavior Analysis (Random Forest)                     │  │  │
│  │  └─────────────────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
│                               │                                             │
│                               ▼                                             │
│                      ┌─────────────────┐                                    │
│                      │  Model Storage  │                                    │
│                      │  /home/ubuntu/  │                                    │
│                      │  tcurity-ai/    │                                    │
│                      │  models/        │                                    │
│                      └─────────────────┘                                    │
│                                                                             │
│                      ┌─────────────────┐                                    │
│                      │   NVIDIA GPU    │                                    │
│                      │   CUDA 12.x     │                                    │
│                      └─────────────────┘                                    │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 2. 서비스 구성

| 서비스 | 컨테이너명 | 포트 | 이미지 | 설명 |
|--------|-----------|------|--------|------|
| **Nginx** | tcurity-nginx | 80, 443 | nginx:1.25-alpine | 리버스 프록시 |
| **Demo** | tcurity-demo | 5173 | ghcr.io/t-curity/demo:dev | 티켓 예매 데모 (Vite) |
| **Backend** | tcurity-backend | 8000 | ghcr.io/t-curity/backend:develop | REST API (FastAPI) |
| **SDK** | tcurity-sdk | 3000 | ghcr.io/t-curity/sdk:dev | Captcha SDK (Vite) |
| **AI** | tcurity-ai | 9000 | ghcr.io/t-curity/ai:develop | AI 추론 서버 (GPU) |

---

## 3. 네트워크 구성

### 3.1 URL 라우팅 (Nginx)
| URL 패턴 | 대상 서비스 | 포트 |
|----------|-------------|------|
| `/` | Demo Site | 5173 |
| `/api/*` | Backend API | 8000 |
| `/sdk.js` | Captcha SDK | 3000 |

### 3.2 내부 통신
- **Main ↔ GPU**: AWS VPC Private Network
- Backend → AI Server: `http://10.0.83.48:9000`

---

## 4. CI/CD 파이프라인

```
┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│  Developer   │────▶│    GitHub    │────▶│     GHCR     │
│  git push    │     │   Actions    │     │   (Images)   │
└──────────────┘     └──────┬───────┘     └──────┬───────┘
                            │                     │
                            ▼                     │
                     ┌──────────────┐             │
                     │ infra-deploy │◀────────────┘
                     │  (Trigger)   │
                     └──────┬───────┘
                            │ SSH Deploy
                     ┌──────┴──────┐
                     ▼             ▼
              ┌───────────┐ ┌───────────┐
              │Main Server│ │GPU Server │
              └───────────┘ └───────────┘
```

---

## 5. 서버 환경

### 카카오 클라우드 프로덕션
| 서버 | Public IP | Private IP |
|------|-----------|------------|
| Main | 61.109.236.16 | 10.0.3.151 |
| GPU | 61.109.238.4 | 10.0.83.48 |

---

## 6. 환경 변수

### Backend
```
AI_SERVER_URL=http://10.0.83.48:9000
```

### AI Server
```
MLFLOW_EXPERIMENT_NAME=captcha-effnet-tracking
IMAGE_DATA_ROOT=/app/data/images
MODEL_OUTPUT_ROOT=/app/models
PHASE_B_PROBLEM_IMAGE_ROOT=/app/data/processed_images
```

---

## 7. 볼륨 마운트

### GPU Server
| 호스트 경로 | 컨테이너 경로 | 용도 |
|------------|--------------|------|
| /home/ubuntu/tcurity-ai/models | /app/models | ML 모델 파일 |
| /home/ubuntu/tcurity-ai/data | /app/data | 학습/추론 데이터 |
